[transmogrifier]
title = Message exporter
description = Exports archetype and dexterity content as email message
pipeline =
    brains
    type
    path
    filter_prefix
    behead_prefix
    object
    rfc822
    clean
    invert
    producer
prefix = /jyu/sport

[brains]
blueprint = transmogrifier.from_expression
condition = path:item/_brain/_unrestrictedGetObject|nothing
_brain = path:context/portal_catalog/unrestrictedSearchResults

[type]
blueprint = transmogrifier.set
_type = path:item/_brain/portal_type

[path]
blueprint = transmogrifier.set
_path = path:item/_brain/getPath

[filter_prefix]
blueprint = transmogrifier.filter
condition = python:item.get('_path').startswith('${transmogrifier:prefix}/')

[behead_prefix]
blueprint = transmogrifier.set
_path = python:item.get('_path')[len('${transmogrifier:prefix}'):]

[object]
blueprint = transmogrifier.set
_object = path:item/_brain/_unrestrictedGetObject

[rfc822]
blueprint = plone.rfc822.export
key = message

[clean]
blueprint = transmogrifier.del
keys = 
    _object
    _brain

[invert]
blueprint = transmogrifier.invert
key = message

[producer]
blueprint = rabbitpy.producer

[breakpoint]
blueprint = transmogrifier.breakpoint

[logger]
blueprint = transmogrifier.logger
name = logger
level = ERROR
